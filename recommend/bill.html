<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bill</title>
    <link rel="stylesheet" href="../css/bill.css">
    <script src="../js/jquery.min.js"></script>
    <script src="../js/jquery.qrcode.min.js"></script>
    <script src="../js/html2canvas.js"></script>
</head>
<body>
<div class="content">
    <div class="coupon">
        <div class="coupon-top">
            <img class="hd" src="https://bing.ioliu.cn/v1/rand" alt="">
            <div class="head-font">bilibili献给新一代的演讲《后浪》</div>
            <img class="avatar" src="../images/avatar.png" alt="">
            <div class="body-font"><b>投河的公鸡 推荐给你</b></div>
            <img class="dotted" src="../images/dotted.png" alt="">
        </div>
        <div class="coupon-con">
            <span class="qrcode"></span>
            <span class="qrcode-font"><b>长按识别二维码浏览<br>saowu's Blog</b></span>
        </div>
    </div>
</div>
<a id="saveImg" style="display: none"></a>
<script type="text/javascript">
    window.onload = function () {
        let title = decodeURI(window.location.href.split("?")[1].split("=")[1]);
        $(".head-font").html(title);
        jQuery('.qrcode').qrcode({
            width: 240,
            height: 240,
            correctLevel: 0,
            image: $(".avatar")[0],
            render: "canvas",
            background: "#ffffff",
            foreground: "darkslategrey",
            text: document.referrer
        });
        html2canvas($('.content'), {
            useCORS: true,
            allowTaint: false,
            tainttest: true,
            logging: false,
            onrendered: function (canvas) {
                let pageData = canvas.toDataURL("image/png");
                let triggerDownload = $("#saveImg").attr("href", pageData).attr("download", new Date().getTime() + ".png");
                triggerDownload[0].click();
            }
        });
        // window.close();
    }
</script>
</body>
</html>


