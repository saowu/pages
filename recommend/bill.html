<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bill|saowu's Blog</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/saowu/saowu.github.io@1.0/css/bill.css">
    <script src="https://cdn.jsdelivr.net/gh/saowu/saowu.github.io@1.0/js/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/saowu/saowu.github.io@1.0/js/jquery.qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/saowu/saowu.github.io@1.0/js/html2canvas.js"></script>
</head>
<body>
<div class="content">
    <div class="coupon">
        <div class="coupon-top">
            <img class="hd" src="">
            <div class="head-font">bilibili献给新一代的演讲《后浪》</div>
            <img class="avatar" src="https://cdn.jsdelivr.net/gh/saowu/saowu.github.io@1.0/images/avatar.png" alt="">
            <div class="body-font"><b>投河的公鸡 推荐给你</b></div>
            <img class="dotted" src="https://cdn.jsdelivr.net/gh/saowu/saowu.github.io@1.0/images/dotted.png" alt="">
        </div>
        <div class="coupon-con">
            <span class="qrcode"></span>
            <span class="qrcode-font"><b>长按识别二维码浏览<br>saowu's Blog</b></span>
        </div>
    </div>
</div>
<a id="saveImg" style="display: none"></a>
<script type="text/javascript">


    $(document).ready(function () {
        function image2Base64(img) {
            let canvas = document.createElement("canvas");
            canvas.width = img.width;
            canvas.height = img.height;
            let ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, img.width, img.height);
            return canvas.toDataURL("image/png");
        }

        function getImgBase64() {
            let base64 = "";
            let img = new Image();
            img.crossOrigin = "";
            img.src = "http://esc.saowu.top:9000/v1/rand";
            img.onload = function () {
                base64 = image2Base64(img);
                $('.hd').attr('src', base64);
            }
        }

        getImgBase64();
    });
    window.onload = function () {
        // let title = decodeURI(window.location.href.split("?")[1].split("=")[1]);
        // $(".head-font").html(title);
        jQuery('.qrcode').qrcode({
            width: 240,
            height: 240,
            correctLevel: 0,
            image: $(".avatar")[0],
            render: "canvas",
            background: "#ffffff",
            foreground: "darkslategrey",
            text: document.referrer
        });
        html2canvas($('.content'), {
            useCORS: true,
            onrendered: function (canvas) {
                let pageData = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
                let triggerDownload = $("#saveImg").attr("href", pageData).attr("download", new Date().getTime() + ".png");
                triggerDownload[0].click();
            }
        });
    }
</script>
</body>
</html>


